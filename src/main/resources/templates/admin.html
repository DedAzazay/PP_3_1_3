<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>


        <title>Admin page</title>
    </head>
    <body>
        <header class="header" >
            <div class="container-fluid" style="background: black; color: white; height: 40px;">
                <div class="row justify-content-between">
                    <div class="col-auto" style="font-size: large; padding-top: 5px">
                        <div style="font-weight: bold; float: left" th:text="${users.getEmail()}">examale@gmail.com</div>
                        <div style="float: left"> with role: </div>
                        <div th:text="${users.getRole().name()}" style="float: right">ROLE</div>
                    </div>
                    <div class="col-1" style="text-align: right">
                        <form action="/auth/logout" method="POST">
                            <button class="btn btn-dark" style="color: #adb5bd" type="submit">Logout</button>
                        </form>
                    </div>
                </div>
            </div>
        </header>
        <section>
            <div class="row">
                <div class="col-2" style="padding-right: 0px; margin-top: 15px">
                    <ul class="nav flex-column">
                        <button class="btn btn-outline-primary active" type="button" data-bs-toggle="tab" href="#adminpanel" style="width: 100%; border: white; text-align: left;">
                            Admin
                        </button>
                        <button class="btn btn-outline-primary" type="button" data-bs-toggle="tab" href="#userpanel" style="width: 100%; border: white; text-align: left">
                            User
                        </button>
                    </ul>
                </div>
                <div class="col" style="background: whitesmoke; height: 615px">
                    <div class="tab-content">
                            <div id="adminpanel" class="tab-pane active">
                                <div class="row" style="margin-right: 50px;">
                                    <h1 style="margin-left: 20px">Admin panel</h1>
                                    <table class="table table-bordered" style="margin-left: 30px; border: gray;">
                                        <thead>
                                            <tr>
                                                <th scope="col">
                                                    All users
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="background: white">
                                                    <table class="table table-striped" style="background: white;">
                                                        <thead>
                                                            <tr style="font-weight: bold;">
                                                                <th scope="row">ID</th>
                                                                <th scope="row">First name</th>
                                                                <th scope="row">Last name</th>
                                                                <th scope="row">Email</th>
                                                                <th scope="row">Role</th>
                                                                <th scope="row">Edit</th>
                                                                <th scope="row">Delete</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr th:each="userOne : ${listUser}">
                                                                <td th:text="${userOne.getId()}">UserId</td>
                                                                <td th:text="${userOne.getName()}">Name</td>
                                                                <td th:text="${userOne.getLastName()}">LastName</td>
                                                                <td th:text="${userOne.getEmail()}">Email</td>
                                                                <td th:text="${userOne.getRole().name()}">Role</td>
                                                                <td>
                                                                    <a th:href="@{admin/show/(id=${userOne.id})}" class="btn btn-primary btn-sm" id="editBtn">

                                                                        Edit
                                                                    </a>
                                                                </td>
                                                                <td>
                                                                    <form th:method="DELETE" th:action="@{/admin/{id}(id=${userOne.getId()})}">
                                                                        <input class="btn btn-sm btn-danger" type="submit" value="Delete"/>
                                                                    </form>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="userpanel" class="tab-pane fade">
                                <div class="row" style="margin-right: 50px;">
                                    <h1 style="margin-left: 20px">User information-page</h1>
                                    <table class="table table-bordered" style="margin-left: 30px; border: gray;">
                                        <thead>
                                        <tr>
                                            <th scope="col">
                                                About user
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td style="background: white">
                                                <table class="table table-striped" style="background: white;">
                                                    <thead>
                                                    <tr style="font-weight: bold;">
                                                        <th scope="row">ID</th>
                                                        <th scope="row">First name</th>
                                                        <th scope="row">Last name</th>
                                                        <th scope="row">Email</th>
                                                        <th scope="row">Role</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td th:text="${users.getId()}">UserId</td>
                                                        <td th:text="${users.getName()}">Name</td>
                                                        <td th:text="${users.getLastName()}">LastName</td>
                                                        <td th:text="${users.getEmail()}">Email</td>
                                                        <td th:text="${users.getRole().name()}">Role</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="myForm">
            <form th:method="PATCH" th:action="@{/admin/{id}(id=0)}">
            <div class="modal fade" id="modal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" >
                        <div class="modal-header">
                            <h5 class="modal-title">Edit user</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="text-align: center; font-weight: bold; margin-left: 25%; margin-right: 25%;">
                            <div class="mb-3">
                                <label for="id" class="col-form-label">ID</label>
                                <input type="text" class="form-control" id="id" name="id" value="" disabled readonly/>
                            </div>
                            <div class="mb-3">
                                <label for="name" class="col-form-label">First name</label>
                                <input type="text" class="form-control" id="name" name="name" value=""/>
                            </div>
                            <div class="mb-3">
                                <label for="lastName" class="col-form-label">Last name</label>
                                <input type="text" class="form-control" id="lastName" name="lastName" value=""/>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="col-form-label">Email</label>
                                <input type="text" class="form-control" id="email" name="email" value=""/>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="col-form-label">Password</label>
                                <input type="text" class="form-control" id="password" name="password" value=""/>
                            </div>
                            <div class="mb-3">
                                <label for="role" class="col-form-label">Role</label>
                                <select class="form-select" id="role" name="role" required>
                                    <option th:each="roles : ${T(ru.kata.spring.boot_security.demo.model.Role).values()}"
                                            th:value="${roles}" th:text="${roles}"/>
                                </select>
                            </div>


                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary" value="Edit"/>
                        </div>
                    </div>
                </div>
            </div>
            </form>

        </div>




        <script>
            document.addEventListener('DOMContentLoaded', function () {

                $('.table #editBtn').on('click', function (event) {
                    event.preventDefault();
                    var href = $(this).attr('href');
                    $.get(href, function (user) {
                        $('.myForm #id').val(user.id);
                        $('.myForm #name').val(user.name);
                        $('.myForm #lastName').val(user.lastName);
                        $('.myForm #email').val(user.email);
                    });
                    new bootstrap.Modal($('.myForm #modal')).show();
                });
            });
        </script>
    </body>
</html>


